<% users = assignment.course.users %>
<% course = assignment.course %>

<div class="btn pull-right" id="expandall">expand all</div>

<h4>Solutions for <%= course.full_name %></h4>
<table class="table table-condensed">
  <thead>
    <tr>
      <th>Name</th>
      <th>Turned-in?</th>
      <th>View Assessments</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  <% users.each do |user| %>
    <% ass =  user.completed_assignments.where(:assignment_id => assignment.id, :current => true) %>
    <% a = ass.first %>
    <tr>
      <td>
	<% if a %> 
	  <%= link_to user.name, a %></td>
        <% else %>
	  <%= user.name %>
	<% end %>
      <td>
	<div class="layer1">
	  <div class="expand_target">
	    <% if a %>
	    <%= a.created_at %>
	    <% end %>
	</div>
	  <div class="expandable">
	    <% if a %>
	    <%= a.completed_task.solution %>
	    <% end %>
	  </div>
	</div>
      </td>
      <td>
	<% if a %>
	  <% a.assessments.each { |assess| %>
	    <%= link_to 'show', edit_assessment_path(assess.id) %>
	  <% } %>
	<% end %>
      </td>
      <td>
	<% if a %>
	<%= link_to 'evaluate', new_assessment_path(:grader_id => current_user.id, :student_id => user.id, :completed_assignment_id => a.id, :official => true) %>
	<% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

